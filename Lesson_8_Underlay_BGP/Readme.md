# Занятие 8. Построение Underlay сети (BGP)
## **План работы**
1. Дизайн
  - Схема
  - Адресное пространство
  - Протоколы и общие замечания
2. Конфигурация
3. Проверка работоспособности
## 1. Дизайн

### Схема

<img width="846" height="518" alt="image" src="https://github.com/user-attachments/assets/5d279c77-82b5-4028-8d78-6e31ba98fa30" />

### Адресное пространство
Распределение адресов для loopback интерфейсов /32:

| Loopback         | Spine1   | Spine2   | Leaf1    |Leaf2     |Leaf3     |
| ---------------- |:--------:| --------:|----------|----------|----------|    
| Lo1              | 10.0.1.0 | 10.0.2.0 | 10.0.1.1 | 10.0.1.2 | 10.0.1.3 |

Распределение адресов для p2p интерфейсов /31:

|  Узел/Интерфейс  | Leaf1   |Leaf2     |Leaf3     |Spine1    |Spine2    |
| ---------------- |:-------:| -------: |--------- |----------|----------|    
| Eth1             | 10.2.1.1| 10.2.1.3 | 10.2.1.5 | 10.2.1.0 | 10.2.2.0 |
| Eth2             | 10.2.2.1| 10.2.2.3 | 10.2.2.5 | 10.2.1.2 | 10.2.2.2 |
| Eth3             |         |          |          | 10.2.1.4 | 10.2.2.4 |

Суммированный маршрут для p2p соединений 10.2.0.0/15

### Протоколы и общие замечания
- Underlay сеть строим на eBGP.
- Для компактности конфигурации используем динамическую peer-group на стороне Spine, адреса соседей и номера их AS задаем через диапазоны (bgp listen range и peer-filter).
- Используем аутентификацию.
- Настраивам мнимальные таймеры 3 9.
- Все Spine находятся в одной AS 65100, каждый Leaf находятся в своей AS из диапазона 65101-65103. Принцип нумерации 65m00 - для Spine, где m - номер POD от 0 до 9; 65mNN для Leaf, где NN - порядковый номер Leaf от 00 до 99 (на случай масштабирования).
- Для анонсированя loopback интерфейсов, используем редистрибьюцию connected сетей в комбинации с ip prefix-lists и route-map.
- Топология с единственным POD.
- Все настроено в GRT, не используется VRF.
- Используем BFD.
- Работает ECMP.

## 2. Конфигурация

Ниже приведены конфигурации узлов.

**Spine1**
```

```
**Spine2**
```

```
**Leaf1**
```

```
**Leaf2**
```

```
**Leaf3**
```

```
